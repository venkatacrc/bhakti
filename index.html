<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Bhakti Repository Index</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
            max-width: 900px;
            margin: 40px auto;
            padding: 0 20px;
            line-height: 1.6;
            color: #333;
            background-color: #fcfcfc;
        }
        h1 {
            border-bottom: 2px solid #eaecef;
            padding-bottom: 10px;
            margin-bottom: 20px;
        }
        .stats {
            font-size: 0.9em;
            color: #666;
            margin-bottom: 20px;
        }
        #file-list {
            list-style: none;
            padding: 0;
            border: 1px solid #e1e4e8;
            border-radius: 6px;
            background-color: #fff;
        }
        #file-list li {
            border-bottom: 1px solid #e1e4e8;
        }
        #file-list li:last-child {
            border-bottom: none;
        }
        #file-list a {
            display: block;
            padding: 12px 15px;
            text-decoration: none;
            color: #0366d6;
            transition: background 0.2s;
        }
        #file-list a:hover {
            background-color: #f6f8fa;
        }
        .path {
            color: #586069;
            font-size: 0.85em;
        }
        .filename {
            font-weight: 600;
            font-size: 1.1em;
            display: block;
        }
        .loading {
            padding: 20px;
            text-align: center;
            color: #666;
        }
        .error {
            color: #d73a49;
            background-color: #ffdce0;
            padding: 15px;
            border-radius: 6px;
        }
    </style>
</head>
<body>

    <h1>üïâÔ∏è Bhakti - All Pages</h1>
    <div id="stats" class="stats"></div>
    
    <ul id="file-list">
        <li class="loading">Scanning repository recursively...</li>
    </ul>

    <script>
        const USER = 'venkatacrc';
        const REPO = 'bhakti';
        const BRANCH = 'main'; // Usually 'main' or 'master'

        // API to get the whole tree recursively
        const API_URL = `https://api.github.com/repos/${USER}/${REPO}/git/trees/${BRANCH}?recursive=1`;
        const BASE_URL = `https://${USER}.github.io/${REPO}/`;

        const listContainer = document.getElementById('file-list');
        const statsContainer = document.getElementById('stats');

        async function fetchFiles() {
            try {
                const response = await fetch(API_URL);
                if (!response.ok) {
                    // Fallback: If 'main' fails, try 'master' (common issue for older repos)
                    if (BRANCH === 'main') {
                        console.warn("Main branch not found, trying master...");
                        const fallbackResponse = await fetch(`https://api.github.com/repos/${USER}/${REPO}/git/trees/master?recursive=1`);
                        if (fallbackResponse.ok) {
                           processData(await fallbackResponse.json());
                           return;
                        }
                    }
                    throw new Error(`GitHub API Error: ${response.status}`);
                }
                
                const data = await response.json();
                processData(data);

            } catch (error) {
                console.error(error);
                listContainer.innerHTML = `<div class="error">
                    <strong>Error loading files:</strong> ${error.message}<br>
                    <small>Make sure the repository is public and the branch exists.</small>
                </div>`;
            }
        }

        function processData(data) {
            listContainer.innerHTML = '';
            
            // 1. Filter for HTML files
            // 2. Exclude the root index.html itself to avoid loops
            const htmlFiles = data.tree.filter(item => 
                item.path.endsWith('.html') && 
                item.path.toLowerCase() !== 'index.html'
            );

            statsContainer.innerText = `Found ${htmlFiles.length} pages across all folders.`;

            if (htmlFiles.length === 0) {
                listContainer.innerHTML = '<li class="loading">No HTML files found.</li>';
                return;
            }

            // Sort alphabetically by path
            htmlFiles.sort((a, b) => a.path.localeCompare(b.path));

            htmlFiles.forEach(item => {
                const li = document.createElement('li');
                const a = document.createElement('a');
                
                // Construct the full URL
                a.href = BASE_URL + item.path;
                
                // Split path for display (e.g., "Hanuman_Chalisa/intro.html")
                const parts = item.path.split('/');
                const fileName = parts.pop();
                const folderPath = parts.join(' / ');

                // Display format:
                // Folder / Path
                // Filename
                a.innerHTML = `
                    ${folderPath ? `<div class="path">üìÇ ${folderPath}</div>` : ''}
                    <span class="filename">${fileName}</span>
                `;
                
                li.appendChild(a);
                listContainer.appendChild(li);
            });
        }

        fetchFiles();
    </script>

</body>
</html>
